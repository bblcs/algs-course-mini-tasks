class Karatsuba {
    static BigInteger multiply(BigInteger x, BigInteger y) {
        int n = Math.max(x.toString().length(), y.toString().length())
        if (n <= 80) {
            return x * y
        }

        int halfN = n / 2
        BigInteger a = x / BigInteger.valueOf(10).pow(halfN)
        BigInteger b = x % BigInteger.valueOf(10).pow(halfN)
        BigInteger c = y / BigInteger.valueOf(10).pow(halfN)
        BigInteger d = y % BigInteger.valueOf(10).pow(halfN)

        BigInteger ac = multiply(a, c)
        BigInteger bd = multiply(b, d)
        BigInteger adPlusBc = multiply(a + b, c + d) - ac - bd


        return ac * BigInteger.valueOf(10).pow(2 * halfN) + adPlusBc * BigInteger.valueOf(10).pow(halfN) + bd
    }
}

// short
assert Karatsuba.multiply(BigInteger.valueOf(101010101010101), BigInteger.valueOf(101010010101010110)) == 10203031323334353525151413121110
// long
assert Karatsuba.multiply(new BigInteger("23266960873670278497366225240291472439241398982022349309735512705459515181833339961626214234263773977162103292721318973902582813832355663163894566233307199252655353692209003941766042638809599737170779496108849594328817077000077991036921989275054026627277784930182137069402111158427222638955050853191165988716237604509528755382340705382833090043769306490729037157289508167439502248741328362630903194976256"), new BigInteger("776607495547484763329285396008152329504086182294561312013839783460379071964664138628999183742587491504854375739118189383760400846222294659163099577095980299221696406896605369228314021750090276807639895820713043212890625")) == new BigInteger("18069296213102393007105064069935780990822760866555145248272303676872555926473131110707393548248528682411770509027695345960964750768148684019594946211987302477655961807972410696111444056324828702058063833979656594406708427863147386210522887423339492254917738044362939617198788265224559396922665176483166078310322110992363917748522922217730729754858582875202360982175139345311121930857832900396639202831380870013288792421985547197083212555074938017050902271606715579284061457988908211352029748670667577632373613411789414466915293306288202622405729056098992904770552284997569719606700168781060412906828771225000000000000000000")
println("All tests passed!")
